version: '1.0'
steps:
  build_step:
    type: build
    image_name: rfeijolo/forklift
    dockerfile: Dockerfile
    tag: ${{CF_BRANCH}}

  push_to_registry:
    title: Pushing to Docker Registry
    type: push
    candidate: ${{build_step}}
    tag: ${{CF_BRANCH}}
    credentials:
      username: ${{dockerUsername}}
      password: ${{dockerPassword}}

  unit_test:
    type: composition
    working_directory: ${{main_clone}}
    composition:
      version: '2'
      services:
        forklift:
          image: "rfeijolo/forklift"
    composition_candidates:
      test:
        image: ${{build_step}}
        command: npm test
